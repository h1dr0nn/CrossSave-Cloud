<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Tauri + SvelteKit + Typescript App</title>
    
		<link rel="modulepreload" href="/_app/immutable/entry/start.BHJU9yL5.js">
		<link rel="modulepreload" href="/_app/immutable/chunks/BPfvFz2G.js">
		<link rel="modulepreload" href="/_app/immutable/chunks/DYAuyVG6.js">
		<link rel="modulepreload" href="/_app/immutable/entry/app.CfMxkgaP.js">
		<link rel="modulepreload" href="/_app/immutable/chunks/B9GUTLQ3.js">
		<link rel="modulepreload" href="/_app/immutable/chunks/BFGhZlYr.js">
		<link rel="modulepreload" href="/_app/immutable/chunks/D5a-4jpI.js">
  </head>
  <body data-sveltekit-preload-data="hover">
    <script>
      // Manual Polyfills for Android 9 / Chrome 80
      if (!Array.prototype.at) {
        Array.prototype.at = function(n) {
          n = Math.trunc(n) || 0;
          if (n < 0) n += this.length;
          if (n < 0 || n >= this.length) return undefined;
          return this[n];
        };
      }
      if (!String.prototype.replaceAll) {
        String.prototype.replaceAll = function(str, newStr) {
          if (Object.prototype.toString.call(str).toLowerCase() === '[object regexp]') {
            return this.replace(str, newStr);
          }
          return this.replace(new RegExp(str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"), 'g'), newStr);
        };
      }
      console.log("DEBUG: SANITY CHECK - JS IS RUNNING (Polyfills loaded)");
    </script>
    <!-- Loading Screen -->
    <div id="app-loading" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#1a1a1a;color:white;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:sans-serif;transition:opacity 0.5s ease;">
      <div class="spinner" style="width:50px;height:50px;border:4px solid #333;border-top:4px solid #646cff;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:20px;"></div>
      <div id="loading-text" style="font-size:18px;font-weight:500;">Initializing CrossSave Cloud...</div>
      <div id="error-message" style="display:none;color:#ff4444;margin-top:20px;padding:20px;background:rgba(255,0,0,0.1);border-radius:8px;max-width:80%;word-break:break-word;"></div>
      <style>
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      </style>
    </div>

    <script>
      // Global Error Handler
      window.addEventListener('error', (e) => {
        console.error("CRITICAL JS ERROR:", e.message, e.filename, e.lineno);
        const loading = document.getElementById('app-loading');
        const spinner = document.querySelector('.spinner');
        const text = document.getElementById('loading-text');
        const errorMsg = document.getElementById('error-message');
        
        if (loading && errorMsg) {
          loading.style.background = "#1a1a1a"; // Keep background
          if (spinner) spinner.style.display = 'none';
          if (text) text.innerText = "Failed to start application";
          errorMsg.style.display = 'block';
          errorMsg.innerText = e.message + "\n" + (e.filename ? e.filename.split('/').pop() : '') + ":" + e.lineno;
        }
      });

      // Hide loading screen when app is mounted
      window.addEventListener('load', () => {
        // We wait for Svelte to mount. If Svelte mounts successfully, 
        // it should ideally remove this or we can set a timeout as backup.
        // For now, we'll let the app handle hiding it, or hide it after a timeout if app fails to hide it.
        // But since we don't have a mechanism in the app to hide it yet, let's hide it here after a short delay
        // assuming Svelte hydrates quickly. 
        // BETTER: The app should remove this div.
        // For now, let's just set a timeout to ensure it goes away if the app works.
        setTimeout(() => {
           const loading = document.getElementById('app-loading');
           if (loading && !document.getElementById('error-message').style.display === 'block') {
               // loading.style.opacity = '0';
               // setTimeout(() => loading.style.display = 'none', 500);
           }
        }, 1000);
      });
    </script>
    <div style="display: contents">
			<script>
				{
					__sveltekit_1iqukly = {
						base: ""
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("/_app/immutable/entry/start.BHJU9yL5.js"),
						import("/_app/immutable/entry/app.CfMxkgaP.js")
					]).then(([kit, app]) => {
						kit.start(app, element);
					});
				}
			</script>
		</div>
  </body>
</html>
