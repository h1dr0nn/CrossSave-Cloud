var ue=(S,m,u)=>new Promise((s,k)=>{var B=o=>{try{g(u.next(o))}catch(n){k(n)}},P=o=>{try{g(u.throw(o))}catch(n){k(n)}},g=o=>o.done?s(o.value):Promise.resolve(o.value).then(B,P);g((u=u.apply(S,m)).next())});import{f as y,a as r,c as ve,d as Me,t as ie}from"../chunks/CZDd9hH4.js";import{i as ne}from"../chunks/CpLcupON.js";import{b3 as Ue,aA as ze,x as de,aQ as Pe,d as a,o as q,u as _,e as t,z as ce,f as te,s as c,b as V,n as e,ai as Ae,af as oe,V as x,S as T,ag as Be,y as De,a1 as Te}from"../chunks/0EX2Om-c.js";import{p as W,i as O}from"../chunks/BTCyUnyO.js";import{s as G,e as X}from"../chunks/BCUew4hU.js";import{h as he,a as ke,s as Ce,j as pe,b as qe,p as Le,v as Re,l as Ke,w as He}from"../chunks/BfOZN3Jg.js";import{g as Fe}from"../chunks/BMkMYqYy.js";import{o as Se,A as Ve}from"../chunks/Qv6r1SzU.js";function We(S,m){Ue(window,["resize"],()=>ze(()=>m(window[S])))}var Qe=y('<p class="empty svelte-112du2d">No emulator profiles found.</p>'),Je=y('<button role="option"><span class="blur-plate svelte-112du2d" aria-hidden="true"></span> <div class="button-surface svelte-112du2d"><div class="icon svelte-112du2d"><svg viewBox="0 0 24 24" aria-hidden="true" class="svelte-112du2d"><path d="M5 7.5A2.5 2.5 0 0 1 7.5 5h9A2.5 2.5 0 0 1 19 7.5v9A2.5 2.5 0 0 1 16.5 19h-9A2.5 2.5 0 0 1 5 16.5Zm2.5-.5a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5Z" fill="currentColor"></path><path d="M9.75 11.25h4.5v1.5h-4.5Z" fill="#10b981"></path><path d="M9.75 14.25h2.5v1.5h-2.5Z" fill="#10b981"></path></svg></div> <div class="text svelte-112du2d"><span class="svelte-112du2d"> </span> <small class="svelte-112du2d"> </small></div></div></button>'),Xe=y('<div class="list svelte-112du2d" role="listbox" aria-label="Emulator profiles"><!></div>');function Ye(S,m){de(m,!1);let u=W(m,"emulators",24,()=>[]),s=W(m,"selectedId",8,null);const k=Pe();function B(v){k("select",v)}ne();var P=Xe(),g=a(P);{var o=v=>{var E=Qe();r(v,E)},n=v=>{var E=ve(),I=te(E);he(I,1,u,pe,(H,L)=>{var D=Je();let F;var f=c(a(D),2),A=c(a(f),2),U=a(A),M=a(U,!0);t(U);var Z=c(U,2),R=a(Z,!0);t(Z),t(A),t(f),t(D),V(()=>{ke(D,"aria-selected",(e(L),q(s()),_(()=>e(L).emulator_id===s()))),F=Ce(D,1,"svelte-112du2d",null,F,{selected:e(L).emulator_id===s()}),G(M,(e(L),_(()=>e(L).name))),G(R,(e(L),_(()=>{var i;return(i=e(L).default_save_paths[0])!=null?i:"No save path"})))}),X("click",D,()=>B(e(L).emulator_id)),r(H,D)}),r(v,E)};O(g,v=>{q(u()),_(()=>u().length===0)?v(o):v(n,!1)})}t(P),r(S,P),ce()}var $e=y('<div class="overlay svelte-181dlmc" aria-hidden="true"></div>'),et=y('<button class="close svelte-181dlmc" aria-label="Close emulator drawer"><svg viewBox="0 0 24 24" aria-hidden="true" class="svelte-181dlmc"><path d="M6 6l12 12m0-12L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg></button>'),tt=y('<!> <aside aria-label="Emulator list"><div class="sidebar-surface svelte-181dlmc"><div class="sidebar-header svelte-181dlmc"><div class="title svelte-181dlmc"><svg viewBox="0 0 24 24" aria-hidden="true" class="svelte-181dlmc"><path d="M6.5 3.5h11a2 2 0 0 1 2 2v13a2 2 0 0 1-2 2h-11a2 2 0 0 1-2-2v-13a2 2 0 0 1 2-2Zm0 2v13h11v-13Z" fill="currentColor"></path><circle cx="9" cy="9" r="1" fill="#10b981"></circle><circle cx="15" cy="9" r="1" fill="#10b981"></circle></svg> <div><p class="svelte-181dlmc">Emulators</p> <small class="svelte-181dlmc"> </small></div></div> <!></div> <div class="list-shell svelte-181dlmc"><!></div></div></aside>',1);function at(S,m){de(m,!1);let u=W(m,"emulators",24,()=>[]),s=W(m,"selectedId",8,null),k=W(m,"isMobile",8,!1),B=W(m,"open",8,!1),P=W(m,"loading",8,!1);const g=Pe();function o(b){g("select",b)}function n(){k()&&g("close")}ne();var v=tt(),E=te(v);{var I=b=>{var l=$e();X("click",l,n),r(b,l)};O(E,b=>{k()&&B()&&b(I)})}var H=c(E,2);let L;var D=a(H),F=a(D),f=a(F),A=c(a(f),2),U=c(a(A),2),M=a(U,!0);t(U),t(A),t(f);var Z=c(f,2);{var R=b=>{var l=et();X("click",l,n),r(b,l)};O(Z,b=>{k()&&b(R)})}t(F);var i=c(F,2),h=a(i);Ye(h,{get emulators(){return u()},get selectedId(){return s()},$$events:{select:b=>o(b.detail)}}),t(i),t(D),t(H),V(()=>{L=Ce(H,1,"svelte-181dlmc",null,L,{selected:!k()||B(),drawer:k()}),G(M,(q(P()),q(u()),_(()=>P()?"Loading profiles":"".concat(u().length," available"))))}),r(S,v),ce()}var st=y('<p class="empty svelte-1hc8sw2">Select an emulator to view its saves.</p>'),lt=Me('<svg viewBox="0 0 24 24" aria-hidden="true"><rect x="4" y="8" width="16" height="8" rx="2" fill="var(--card-contrast)"></rect><path d="M9.5 11h5v2h-5z" fill="#22c55e"></path><circle cx="8" cy="12" r="1" fill="#22c55e"></circle><circle cx="16" cy="12" r="1" fill="#22c55e"></circle></svg>'),rt=Me('<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3 9.5 11h-5L10 13l-2.5 8L12 15l4.5 6-2.5-8 5.5-2h-5Z" fill="#0ea5e9"></path></svg>'),it=Me('<svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="8" fill="#6366f1"></circle><circle cx="12" cy="12" r="3" fill="#e0f2fe"></circle></svg>'),ot=y('<button class="card svelte-1hc8sw2"><div class="icon svelte-1hc8sw2"><!></div> <div class="meta svelte-1hc8sw2"><strong class="svelte-1hc8sw2"> </strong> <span class="svelte-1hc8sw2"> </span></div> <svg class="chevron svelte-1hc8sw2" viewBox="0 0 24 24" aria-hidden="true"><path d="m9 5 7 7-7 7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg></button>'),vt=y('<div class="grid svelte-1hc8sw2"></div>'),nt=y('<section class="panel svelte-1hc8sw2"><header class="svelte-1hc8sw2"><div><p class="eyebrow svelte-1hc8sw2">Games</p> <h2 class="svelte-1hc8sw2"> </h2></div> <span class="badge svelte-1hc8sw2"> </span></header> <!></section>');function dt(S,m){de(m,!1);let u=W(m,"games",24,()=>[]),s=W(m,"emulatorName",8,"");const k=new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});function B(f){return k.format(new Date(f))}function P(f){Fe("/game/".concat(encodeURIComponent(f)))}ne();var g=nt(),o=a(g),n=a(o),v=c(a(n),2),E=a(v,!0);t(v),t(n);var I=c(n,2),H=a(I);t(I),t(o);var L=c(o,2);{var D=f=>{var A=st();r(f,A)},F=f=>{var A=vt();he(A,5,u,pe,(U,M)=>{var Z=ot(),R=a(Z),i=a(R);{var h=N=>{var Q=lt();r(N,Q)},b=N=>{var Q=ve(),Y=te(Q);{var ae=z=>{var J=rt();r(z,J)},se=z=>{var J=it();r(z,J)};O(Y,z=>{e(M),_(()=>e(M).icon==="spark")?z(ae):z(se,!1)},!0)}r(N,Q)};O(i,N=>{e(M),_(()=>e(M).icon==="console")?N(h):N(b,!1)})}t(R);var l=c(R,2),C=a(l),p=a(C,!0);t(C);var d=c(C,2),j=a(d,!0);t(d),t(l),Ae(2),t(Z),V(N=>{ke(R,"data-variant",(e(M),_(()=>e(M).icon))),G(p,(e(M),_(()=>e(M).name))),G(j,N)},[()=>(e(M),_(()=>B(e(M).lastModified)))]),X("click",Z,()=>P(e(M).id)),r(U,Z)}),t(A),r(f,A)};O(L,f=>{q(u()),_(()=>u().length===0)?f(D):f(F,!1)})}t(g),V(()=>{var f;G(E,s()||"Choose an emulator"),G(H,"".concat((f=(q(u()),_(()=>u().length)))!=null?f:""," titles"))}),r(S,g),ce()}var ct=y('<button class="debug-btn svelte-mmttu1" title="Check paths"><svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" class="svelte-mmttu1"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></button>'),ut=y('<li><div class="status-icon"><!></div> <div class="path-details svelte-mmttu1"><span class="path svelte-mmttu1"> </span> <span class="error svelte-mmttu1"><!></span></div></li>'),mt=y('<div class="debug-panel svelte-mmttu1"><div class="debug-header svelte-mmttu1"><h3 class="svelte-mmttu1">Path Status</h3> <button>Close</button></div> <ul class="path-list svelte-mmttu1"></ul></div>'),ft=y('<p class="empty svelte-mmttu1">Loading emulator profile…</p>'),ht=y('<p class="empty svelte-mmttu1">Choose an emulator to preview save details.</p>'),pt=y('<code class="svelte-mmttu1"> </code>'),_t=y('<li class="svelte-mmttu1"> </li>'),gt=y('<div class="fields svelte-mmttu1"><div class="field svelte-mmttu1"><p class="label svelte-mmttu1">Save path</p> <div class="value svelte-mmttu1"> </div></div> <div class="field svelte-mmttu1"><p class="label svelte-mmttu1">Pattern</p> <div class="value chips svelte-mmttu1"></div></div> <div class="preview svelte-mmttu1"><div class="preview-head svelte-mmttu1"><div><p class="eyebrow svelte-mmttu1">Matched files</p> <strong class="svelte-mmttu1"> </strong></div> <span class="pill svelte-mmttu1">Live preview</span></div> <ul class="svelte-mmttu1"></ul></div></div>'),wt=y('<section class="panel svelte-mmttu1"><header class="svelte-mmttu1"><div><p class="eyebrow svelte-mmttu1">Save folder preview</p> <h2 class="svelte-mmttu1"> </h2></div> <div class="actions svelte-mmttu1"><!> <button class="open svelte-mmttu1"><svg viewBox="0 0 24 24" aria-hidden="true" class="svelte-mmttu1"><path d="M4.5 6a2 2 0 0 1 2-2h2.9a1 1 0 0 1 .83.45L11.8 6H17.5A2.5 2.5 0 0 1 20 8.5v8.25a1.75 1.75 0 0 1-1.75 1.75h-11.5A2.25 2.25 0 0 1 4.5 16.25Z" fill="currentColor"></path></svg> Open folder</button></div></header> <!> <!></section>');function bt(S,m){de(m,!1);const u=T();let s=W(m,"profile",8,null),k=W(m,"loading",8,!1);function B(){return ue(this,null,function*(){var i;if((i=s())!=null&&i.default_save_paths.length){for(const h of s().default_save_paths)try{yield Se(h);return}catch(b){console.warn("Failed to open ".concat(h),b)}qe("Could not open specific folder. Opening file manager...");try{yield Se("/storage/emulated/0")}catch(h){console.error("Failed to open root storage",h),Le("Unable to open file manager.")}}})}let P=T([]),g=T(!1);function o(){return ue(this,null,function*(){if(s())try{x(P,yield Re(s().emulator_id)),x(g,!0)}catch(i){console.error("Failed to check paths",i),Le("Failed to check path status")}})}oe(()=>q(s()),()=>{x(u,s()?Math.max(s().file_patterns.length*Math.max(s().default_save_paths.length,1),0):0)}),Be(),ne();var n=wt(),v=a(n),E=a(v),I=c(a(E),2),H=a(I,!0);t(I),t(E);var L=c(E,2),D=a(L);{var F=i=>{var h=ct();X("click",h,o),r(i,h)};O(D,i=>{s()&&i(F)})}var f=c(D,2);t(L),t(v);var A=c(v,2);{var U=i=>{var h=mt(),b=a(h),l=c(a(b),2);t(b);var C=c(b,2);he(C,5,()=>e(P),pe,(p,d)=>{var j=ut();let N;var Q=a(j),Y=a(Q);{var ae=w=>{var K=ie("✅");r(w,K)},se=w=>{var K=ie("❌");r(w,K)};O(Y,w=>{e(d),_(()=>e(d).exists&&e(d).is_dir)?w(ae):w(se,!1)})}t(Q);var z=c(Q,2),J=a(z),_e=a(J,!0);t(J);var ge=c(J,2),we=a(ge);{var $=w=>{var K=ie("Not found");r(w,K)},ee=w=>{var K=ve(),Ze=te(K);{var je=le=>{var be=ie("Not a directory");r(le,be)},Ne=le=>{var be=ve(),Oe=te(be);{var Ge=re=>{var xe=ie();V(()=>{var Ee;return G(xe,"Error: ".concat((Ee=(e(d),_(()=>e(d).error)))!=null?Ee:""))}),r(re,xe)},Ie=re=>{var xe=ie("OK");r(re,xe)};O(Oe,re=>{e(d),_(()=>e(d).error)?re(Ge):re(Ie,!1)},!0)}r(le,be)};O(Ze,le=>{e(d),_(()=>!e(d).is_dir)?le(je):le(Ne,!1)},!0)}r(w,K)};O(we,w=>{e(d),_(()=>!e(d).exists)?w($):w(ee,!1)})}t(ge),t(z),t(j),V(()=>{N=Ce(j,1,"svelte-mmttu1",null,N,{valid:e(d).exists&&e(d).is_dir,invalid:!e(d).exists||!e(d).is_dir}),G(_e,(e(d),_(()=>e(d).path)))}),r(p,j)}),t(C),t(h),X("click",l,()=>x(g,!1)),r(i,h)};O(A,i=>{e(g)&&i(U)})}var M=c(A,2);{var Z=i=>{var h=ft();r(i,h)},R=i=>{var h=ve(),b=te(h);{var l=p=>{var d=ht();r(p,d)},C=p=>{var d=gt(),j=a(d),N=c(a(j),2),Q=a(N,!0);t(N),t(j);var Y=c(j,2),ae=c(a(Y),2);he(ae,5,()=>(q(s()),_(()=>s().file_patterns)),pe,($,ee)=>{var w=pt(),K=a(w,!0);t(w),V(()=>G(K,e(ee))),r($,w)}),t(ae),t(Y);var se=c(Y,2),z=a(se),J=a(z),_e=c(a(J),2),ge=a(_e);t(_e),t(J),Ae(2),t(z);var we=c(z,2);he(we,5,()=>(q(s()),_(()=>s().file_patterns)),pe,($,ee)=>{var w=_t(),K=a(w,!0);t(w),V(()=>G(K,e(ee))),r($,w)}),t(we),t(se),t(d),V(($,ee)=>{var w;ke(N,"title",$),G(Q,ee),G(ge,"".concat((w=e(u))!=null?w:""," detected"))},[()=>(q(s()),_(()=>s().default_save_paths.join(", "))),()=>(q(s()),_(()=>s().default_save_paths.join("\n")))]),r(p,d)};O(b,p=>{s()?p(C,!1):p(l)},!0)}r(i,h)};O(M,i=>{k()?i(Z):i(R,!1)})}t(n),V(()=>{G(H,(q(s()),_(()=>{var i,h;return(h=(i=s())==null?void 0:i.name)!=null?h:"Select an emulator"}))),f.disabled=(q(s()),_(()=>{var i;return!((i=s())!=null&&i.default_save_paths.length)}))}),X("click",f,B),r(S,n),ce()}const ye=[];let me=new Map,fe=null;var xt=y('<button slot="actions" class="icon-button primary" aria-label="Open settings"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M10.75 3.5h2.5l.58 2.25a5 5 0 0 1 1.4.82L17.5 6l1.75 2.76-1.72 1.26c.06.3.09.62.09.94 0 .32-.03.63-.09.93l1.72 1.27L17.5 16l-2.27-.57a5 5 0 0 1-1.4.82l-.58 2.25h-2.5l-.58-2.25a5 5 0 0 1-1.4-.82L6.5 16l-1.75-2.76 1.72-1.27A5 5 0 0 1 6.38 11c0-.32.03-.63.09-.93L4.75 8.76 6.5 6l2.27.57a5 5 0 0 1 1.4-.82Z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="12" cy="12" r="2.5" fill="currentColor"></circle></svg></button>'),yt=y('<div class="shell svelte-1ybayt"><!> <div class="content svelte-1ybayt"><div class="content-surface svelte-1ybayt"><main class="content-body svelte-1ybayt"><div class="header-wrapper svelte-1ybayt"><!></div> <div class="content-grid svelte-1ybayt"><!> <!></div></main></div></div></div>');function kt(S,m){de(m,!1);const u=T(),s=T(),k=T(),B=T(),P=900;let g=T([]),o=T(null),n=T(0),v=T(!1),E=T(!0);De(()=>ue(null,null,function*(){var l,C;if(ye.length>0){x(g,[...ye]),x(o,(C=fe!=null?fe:(l=ye[0])==null?void 0:l.emulator_id)!=null?C:null),e(o)&&I(e(o)),x(E,!1);return}try{const p=yield Ke();x(g,p),ye.push(...p),p.length>0&&(x(o,p[0].emulator_id),fe=e(o),I(e(o)))}catch(p){console.error("Failed to load emulator profiles",p)}finally{x(E,!1)}}));function I(l){return ue(this,null,function*(){if(!me.has(l))try{const p=(yield He(l)).map((d,j)=>({id:d.path,emulatorId:l,name:d.name,icon:j%3===0?"spark":j%2===0?"disc":"console",lastModified:new Date(d.modified).toISOString()}));p.sort((d,j)=>new Date(j.lastModified).getTime()-new Date(d.lastModified).getTime()),me.set(l,p),me=me}catch(C){console.error("Failed to scan files for ".concat(l),C)}})}function H(l){x(o,l),fe=l,I(l),e(s)&&x(v,!1)}function L(){x(v,!e(v))}function D(){Fe("/settings",{keepFocus:!0,noScroll:!0})}oe(()=>(e(g),e(o)),()=>{var l;x(u,(l=e(g).find(C=>C.emulator_id===e(o)))!=null?l:null)}),oe(()=>e(n),()=>{x(s,e(n)<P)}),oe(()=>(e(s),e(v)),()=>{!e(s)&&e(v)&&x(v,!1)}),oe(()=>(e(v),e(s)),()=>{x(k,e(v)||!e(s))}),oe(()=>e(o),()=>{var l;x(B,e(o)?(l=me.get(e(o)))!=null?l:[]:[])}),Be(),ne();var F=yt(),f=a(F);at(f,{get emulators(){return e(g)},get selectedId(){return e(o)},get isMobile(){return e(s)},get open(){return e(k)},get loading(){return e(E)},$$events:{select:l=>H(l.detail),close:()=>x(v,!1)}});var A=c(f,2),U=a(A),M=a(U),Z=a(M),R=a(Z);Ve(R,{eyebrow:"CrossSave Cloud",title:"Dashboard",get showMenu(){return e(s)},onMenu:L,onBack:()=>{},sticky:!1,$$slots:{actions:(l,C)=>{var p=xt();X("click",p,D),r(l,p)}}}),t(Z);var i=c(Z,2),h=a(i);{let l=Te(()=>(e(u),_(()=>{var C,p;return(p=(C=e(u))==null?void 0:C.name)!=null?p:""})));dt(h,{get games(){return e(B)},get emulatorName(){return e(l)}})}var b=c(h,2);bt(b,{get profile(){return e(u)},get loading(){return e(E)}}),t(i),t(M),t(U),t(A),t(F),V(()=>ke(F,"data-mobile",e(s))),We("innerWidth",l=>x(n,l)),r(S,F),ce()}var Mt=y('<div class="error-screen svelte-1n46o8q"><h1 class="svelte-1n46o8q">Something went wrong</h1> <p class="svelte-1n46o8q">Check the developer console for more details.</p></div>');function Ct(S,m){de(m,!1);let u=T(!1);function s(n){var v;console.error("Uncaught error",(v=n.error)!=null?v:n.message),x(u,!0)}function k(n){console.error("Unhandled promise rejection",n.reason),x(u,!0)}De(()=>(console.log("DEBUG: App.svelte mounted"),window.addEventListener("error",s),window.addEventListener("unhandledrejection",k),()=>{window.removeEventListener("error",s),window.removeEventListener("unhandledrejection",k)})),ne();var B=ve(),P=te(B);{var g=n=>{kt(n,{})},o=n=>{var v=Mt();r(n,v)};O(P,n=>{e(u)?n(o,!1):n(g)})}r(S,B),ce()}function jt(S){Ct(S,{})}export{jt as component};
