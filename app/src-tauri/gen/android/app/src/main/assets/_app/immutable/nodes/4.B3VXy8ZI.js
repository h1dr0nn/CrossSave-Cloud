var Et=Object.defineProperty,Ct=Object.defineProperties;var Ht=Object.getOwnPropertyDescriptors;var it=Object.getOwnPropertySymbols;var Nt=Object.prototype.hasOwnProperty,Rt=Object.prototype.propertyIsEnumerable;var rt=(u,n,v)=>n in u?Et(u,n,{enumerable:!0,configurable:!0,writable:!0,value:v}):u[n]=v,g=(u,n)=>{for(var v in n||(n={}))Nt.call(n,v)&&rt(u,v,n[v]);if(it)for(var v of it(n))Rt.call(n,v)&&rt(u,v,n[v]);return u},h=(u,n)=>Ct(u,Ht(n));var S=(u,n,v)=>new Promise(($,A)=>{var t=f=>{try{F(v.next(f))}catch(s){A(s)}},y=f=>{try{F(v.throw(f))}catch(s){A(s)}},F=f=>f.done?$(f.value):Promise.resolve(f.value).then(t,y);F((v=v.apply(u,n)).next())});import{f as K,a as M,c as Mt}from"../chunks/DPnlUN19.js";import{i as nt}from"../chunks/CJhM_Lgy.js";import{x as ct,y as vt,b as Ae,z as dt,d as r,s as o,V as b,S as U,e as i,n as e,w as Ut,af as Q,ag as Lt,u as _,ah as L,ai as W,f as qt}from"../chunks/TqzBH3f9.js";import{e as w,s as O}from"../chunks/Ccd0LZme.js";import{s as ut,a as Fe,i as lt}from"../chunks/XC4p9u9B.js";import{a as G,s as re,g as Gt,p as E,c as Kt,b as ie,u as jt,d as zt,e as Jt,l as Vt,f as Yt,r as H,h as Qt,j as Wt}from"../chunks/DVZCo2vZ.js";import{b as q,a as ot}from"../chunks/C5xLO1da.js";import{g as Xt}from"../chunks/Z452qOzf.js";import{A as Zt,o as ea}from"../chunks/BtaKOGW2.js";import{t as X}from"../chunks/DKaeJZEq.js";var ta=K('<section class="panel svelte-tx29xk"><div class="section-header svelte-tx29xk"><p class="label svelte-tx29xk">Theme</p> <span class="hint svelte-tx29xk">Applies instantly</span></div> <div class="segmented svelte-tx29xk" role="group" aria-label="Theme selector"><button>Light</button> <button>Dark</button> <button>System</button></div> <div class="status svelte-tx29xk"><span class="dot svelte-tx29xk" aria-hidden="true"></span> <p> </p></div></section>');function aa(u,n){ct(n,!1);const v=()=>Fe(y,"$themePreference",A),$=()=>Fe(F,"$activeTheme",A),[A,t]=ut(),y=X.preference,F=X.activeTheme;let f=U(!1);vt(()=>{if(typeof localStorage!="undefined"){const R=localStorage.getItem("ui-theme");b(f,R==="light"||R==="dark")}});function s(){b(f,!0),X.setTheme("light")}function T(){b(f,!0),X.setTheme("dark")}function C(){b(f,!1),X.setTheme("system")}nt();var B=ta(),c=o(r(B),2),l=r(c);let m;var k=o(l,2);let N;var j=o(k,2);let Z;i(c);var ee=o(c,2),z=o(r(ee),2),le=r(z);i(z),i(ee),i(B),Ae(()=>{var R;G(l,"aria-pressed",v()==="light"),m=re(l,1,"svelte-tx29xk",null,m,{active:v()==="light"}),G(k,"aria-pressed",v()==="dark"),N=re(k,1,"svelte-tx29xk",null,N,{active:v()==="dark"}),G(j,"aria-pressed",v()==="system"),Z=re(j,1,"svelte-tx29xk",null,Z,{active:v()==="system"}),O(le,"Current theme: ".concat((R=$())!=null?R:"").concat(e(f)?" (manual)":" (system)"))}),w("click",l,s),w("click",k,T),w("click",j,C),M(u,B),dt(),t()}const pt="save-path-overrides",ft=typeof window!="undefined";function sa(){if(!ft)return{};try{const u=localStorage.getItem(pt);return u?JSON.parse(u):{}}catch(u){return console.warn("Unable to read overrides",u),{}}}function ia(u){if(ft)try{localStorage.setItem(pt,JSON.stringify(u))}catch(n){console.warn("Unable to persist overrides",n)}}function ra(){const{subscribe:u,update:n,set:v}=Ut({profiles:[],loadingProfiles:!1,selectedProfileId:null,overrides:sa(),appSettings:null,storageInfo:null,loadingStorage:!1,savingSettings:!1,savingProfile:!1,retentionBounds:[5,20]});function $(){return S(this,null,function*(){n(c=>h(g({},c),{loadingProfiles:!0}));try{const c=yield Vt();n(l=>{var m,k,N;return h(g({},l),{profiles:c,loadingProfiles:!1,selectedProfileId:(N=(k=l.selectedProfileId)!=null?k:(m=c[0])==null?void 0:m.emulator_id)!=null?N:null})})}catch(c){n(l=>h(g({},l),{loadingProfiles:!1})),E("Failed to load profiles: ".concat(c))}})}function A(){return S(this,null,function*(){try{const c=yield Yt();n(l=>h(g({},l),{appSettings:c}))}catch(c){E("Failed to load settings: ".concat(c))}})}function t(){return S(this,null,function*(){n(c=>h(g({},c),{loadingStorage:!0}));try{const c=yield Gt();n(l=>h(g({},l),{storageInfo:c,loadingStorage:!1,retentionBounds:c.retention_bounds}))}catch(c){n(l=>h(g({},l),{loadingStorage:!1})),E("Failed to fetch storage info: ".concat(c))}})}function y(c){return S(this,null,function*(){n(l=>h(g({},l),{savingProfile:!0}));try{const l=yield Jt(c);ie("Saved profile ".concat(l.name)),yield $(),n(m=>h(g({},m),{selectedProfileId:l.emulator_id,savingProfile:!1}))}catch(l){n(m=>h(g({},m),{savingProfile:!1})),E("Failed to save profile: ".concat(l))}})}function F(c){return S(this,null,function*(){n(l=>h(g({},l),{savingProfile:!0}));try{yield zt(c),ie("Deleted profile ".concat(c)),yield $(),n(l=>h(g({},l),{savingProfile:!1,selectedProfileId:null}))}catch(l){n(m=>h(g({},m),{savingProfile:!1})),E("Failed to delete profile: ".concat(l))}})}function f(c){return S(this,null,function*(){n(l=>h(g({},l),{savingSettings:!0}));try{const l=yield jt(c);n(m=>h(g({},m),{appSettings:l,savingSettings:!1})),ie("Settings updated"),yield t()}catch(l){n(m=>h(g({},m),{savingSettings:!1})),E("Failed to update settings: ".concat(l))}})}function s(){return S(this,null,function*(){try{yield Kt(),ie("History cache cleared"),yield t()}catch(c){E("Unable to clear history cache: ".concat(c))}})}function T(c,l){n(m=>{const k=h(g({},m.overrides),{[c]:l});return ia(k),h(g({},m),{overrides:k})})}function C(c){n(l=>h(g({},l),{selectedProfileId:c}))}function B(){return S(this,null,function*(){yield Promise.all([$(),A(),t()])})}return{subscribe:u,load:B,refreshProfiles:$,saveProfile:y,deleteProfile:F,applySettings:f,clearHistory:s,setOverride:T,setSelectedProfile:C,refreshStorage:t,setState:v}}const I=ra();var la=K('<p class="muted svelte-1i19ct2">Loading profiles...</p>'),oa=K('<p class="muted svelte-1i19ct2">No profiles found.</p>'),na=K('<button><div><p class="label svelte-1i19ct2"> </p> <p class="id svelte-1i19ct2"> </p></div> <p class="path svelte-1i19ct2"> </p></button>'),ca=K('<div class="cards svelte-1i19ct2"></div>'),va=K('<section class="settings svelte-1i19ct2"><!> <div class="accordion-stack svelte-1i19ct2"><details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Profiles</p> <h2 class="svelte-1i19ct2">Emulator Profiles</h2></div> <span class="hint svelte-1i19ct2">Manage emulator save paths</span></summary> <div class="accordion-body svelte-1i19ct2"><div class="profile-grid svelte-1i19ct2"><div class="profile-list svelte-1i19ct2"><div class="list-header svelte-1i19ct2"><p class="section-title svelte-1i19ct2">Loaded Profiles</p> <button class="ghost svelte-1i19ct2">Add Profile</button></div> <!></div> <div class="profile-form svelte-1i19ct2"><div class="form-header svelte-1i19ct2"><div><p class="section-title svelte-1i19ct2"> </p> <p class="muted svelte-1i19ct2">Configure emulator metadata and save paths.</p></div> <div class="actions svelte-1i19ct2"><button class="ghost svelte-1i19ct2">Cancel</button> <button class="secondary svelte-1i19ct2">Delete</button> <button class="primary svelte-1i19ct2"> </button></div></div> <div class="field-group svelte-1i19ct2"><label for="name" class="svelte-1i19ct2">Name</label> <input id="name" placeholder="RetroArch" autocomplete="off" class="svelte-1i19ct2"/></div> <div class="field-group svelte-1i19ct2"><label for="emulatorId" class="svelte-1i19ct2">Emulator ID</label> <input id="emulatorId" placeholder="retroarch" autocomplete="off" class="svelte-1i19ct2"/></div> <div class="field-group svelte-1i19ct2"><label for="savePath" class="svelte-1i19ct2">Save path</label> <input id="savePath" placeholder="~/saves/retroarch" class="svelte-1i19ct2"/> <p class="muted svelte-1i19ct2">Used as the default path unless override is enabled.</p></div> <div class="field-group svelte-1i19ct2"><label for="patterns" class="svelte-1i19ct2">Glob patterns</label> <input id="patterns" placeholder="*.sav, *.srm, *.state" class="svelte-1i19ct2"/> <p class="muted svelte-1i19ct2">Comma or newline separated patterns.</p></div> <div class="override-row svelte-1i19ct2"><label class="toggle svelte-1i19ct2"><input type="checkbox" class="svelte-1i19ct2"/> <span>Override save path</span></label> <input placeholder="/custom/path/to/saves" class="override-input svelte-1i19ct2" aria-label="Override path"/></div></div></div></div></details> <details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Backups</p> <h2 class="svelte-1i19ct2">Backup Retention</h2></div> <span class="hint svelte-1i19ct2">Keep your versions tidy</span></summary> <div class="accordion-body retention svelte-1i19ct2"><div class="field-group inline svelte-1i19ct2"><label for="retentionRange" class="svelte-1i19ct2">Versions to keep</label> <div class="range-row svelte-1i19ct2"><input type="range" id="retentionRange" class="svelte-1i19ct2"/> <span class="value svelte-1i19ct2"> </span></div></div> <label class="toggle svelte-1i19ct2"><input type="checkbox" class="svelte-1i19ct2"/> <span>Auto delete old versions</span></label> <div class="actions svelte-1i19ct2"><button class="primary svelte-1i19ct2"> </button></div></div></details> <details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Storage</p> <h2 class="svelte-1i19ct2">App Storage</h2></div> <span class="hint svelte-1i19ct2">History cache and folders</span></summary> <div class="accordion-body storage svelte-1i19ct2"><div class="stat svelte-1i19ct2"><p class="label svelte-1i19ct2">History folder</p> <p class="value svelte-1i19ct2"> </p></div> <div class="stat svelte-1i19ct2"><p class="label svelte-1i19ct2">Current size</p> <p class="value svelte-1i19ct2"> </p></div> <div class="actions svelte-1i19ct2"><button class="secondary svelte-1i19ct2">Open storage folder</button> <button class="primary svelte-1i19ct2">Clear all history cache</button></div></div></details> <details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Appearance</p> <h2 class="svelte-1i19ct2">Theme</h2></div> <span class="hint svelte-1i19ct2">Dark or light</span></summary> <div class="accordion-body svelte-1i19ct2"><!></div></details></div></section>');function Sa(u,n){ct(n,!1);const v=()=>Fe(I,"$settingsStore",$),[$,A]=ut(),t=U(),y=U(),F="*.sav, *.srm, *.state",f=()=>({name:"",emulatorId:"",savePath:"",patterns:F,useOverride:!1,overridePath:""});let s=U(f()),T=U(10),C=U(!0),B=U(null);function c(){Xt("/",{keepFocus:!0,noScroll:!0})}vt(()=>{I.load()});function l(a,d){var P,se,D;const p=d[a.emulator_id];return{name:a.name,emulatorId:a.emulator_id,savePath:(P=a.default_save_paths[0])!=null?P:"",patterns:a.file_patterns.join(", "),useOverride:(se=p==null?void 0:p.enabled)!=null?se:!1,overridePath:(D=p==null?void 0:p.path)!=null?D:""}}function m(a){I.setSelectedProfile(a.emulator_id)}function k(){I.setSelectedProfile(null),b(B,null),b(s,f())}function N(){return e(s).name.trim()?e(s).emulatorId.trim()?e(s).savePath.trim()?e(s).patterns.split(/[,\n]/).map(d=>d.trim()).filter(Boolean).length===0?"Please provide at least one glob pattern":null:"Save path is required":"Emulator ID is required":"Name is required"}function j(){return S(this,null,function*(){const a=N();if(a){E(a);return}const d=e(s).patterns.split(/[,\n]/).map(P=>P.trim()).filter(Boolean),p={emulator_id:e(s).emulatorId.trim(),name:e(s).name.trim(),default_save_paths:[e(s).savePath.trim()],file_patterns:d};yield I.saveProfile(p),I.setOverride(p.emulator_id,{enabled:e(s).useOverride,path:e(s).overridePath.trim()})})}function Z(){return S(this,null,function*(){if(!e(s).emulatorId){b(s,f());return}yield I.deleteProfile(e(s).emulatorId)})}function ee(){if(e(y)){b(s,l(e(y),e(t).overrides));return}b(s,f())}function z(a){var p;const d=e(t).overrides[a.emulator_id];return d!=null&&d.enabled&&d.path.trim()?d.path.trim():(p=a.default_save_paths[0])!=null?p:""}function le(a){if(!a)return"0 B";const d=["B","KB","MB","GB"];let p=a,P=0;for(;p>=1024&&P<d.length-1;)p/=1024,P+=1;return"".concat(p.toFixed(p>=10?0:1)," ").concat(d[P])}function R(){return S(this,null,function*(){if(e(t).storageInfo)try{yield ea(e(t).storageInfo.history_path)}catch(a){E("Unable to open storage: ".concat(a))}})}function mt(){return S(this,null,function*(){e(t).appSettings&&(yield I.applySettings({retention_limit:e(T),auto_delete:e(C)}))})}Q(()=>v(),()=>{b(t,v())}),Q(()=>(e(t),I),()=>{!e(t).selectedProfileId&&e(t).profiles.length>0&&I.setSelectedProfile(e(t).profiles[0].emulator_id)}),Q(()=>e(t),()=>{var a;b(y,(a=e(t).profiles.find(d=>d.emulator_id===e(t).selectedProfileId))!=null?a:null)}),Q(()=>e(t),()=>{e(t).appSettings&&(b(T,e(t).appSettings.retention_limit),b(C,e(t).appSettings.auto_delete))}),Q(()=>(e(t),e(B),e(y)),()=>{e(t).selectedProfileId!==e(B)&&(b(B,e(t).selectedProfileId),e(y)?b(s,l(e(y),e(t).overrides)):b(s,f()))}),Lt(),nt();var oe=va(),Te=r(oe);Zt(Te,{title:"Settings",showBack:!0,onBack:c,onMenu:()=>{},sticky:!1});var De=o(Te,2),ne=r(De),Ee=o(r(ne),2),Ce=r(Ee),ce=r(Ce),ve=r(ce),gt=o(r(ve),2);i(ve);var ht=o(ve,2);{var _t=a=>{var d=la();M(a,d)},bt=a=>{var d=Mt(),p=qt(d);{var P=D=>{var V=oa();M(D,V)},se=D=>{var V=ca();Qt(V,5,()=>(e(t),_(()=>e(t).profiles)),Wt,(Bt,x)=>{var Y=na(),$e=r(Y),Be=r($e),Ot=r(Be,!0);i(Be);var st=o(Be,2),At=r(st,!0);i(st),i($e);var Oe=o($e,2),Ft=r(Oe,!0);i(Oe),i(Y),Ae((Tt,Dt)=>{re(Y,1,(e(t),e(x),_(()=>"card ".concat(e(t).selectedProfileId===e(x).emulator_id?"active":""))),"svelte-1i19ct2"),O(Ot,(e(x),_(()=>e(x).name))),O(At,(e(x),_(()=>e(x).emulator_id))),G(Oe,"title",Tt),O(Ft,Dt)},[()=>(e(x),_(()=>z(e(x)))),()=>(e(x),_(()=>z(e(x))))]),w("click",Y,()=>m(e(x))),M(Bt,Y)}),i(V),M(D,V)};lt(p,D=>{e(t),_(()=>e(t).profiles.length===0)?D(P):D(se,!1)},!0)}M(a,d)};lt(ht,a=>{e(t),_(()=>e(t).loadingProfiles)?a(_t):a(bt,!1)})}i(ce);var He=o(ce,2),de=r(He),ue=r(de),Ne=r(ue),yt=r(Ne,!0);i(Ne),W(2),i(ue);var Re=o(ue,2),Me=r(Re),pe=o(Me,2),te=o(pe,2),Pt=r(te,!0);i(te),i(Re),i(de);var fe=o(de,2),Ue=o(r(fe),2);H(Ue),i(fe);var me=o(fe,2),Le=o(r(me),2);H(Le),i(me);var ge=o(me,2),qe=o(r(ge),2);H(qe),W(2),i(ge);var he=o(ge,2),Ge=o(r(he),2);H(Ge),W(2),i(he);var Ke=o(he,2),_e=r(Ke),je=r(_e);H(je),W(2),i(_e);var be=o(_e,2);H(be),i(Ke),i(He),i(Ce),i(Ee),i(ne);var ye=o(ne,2),ze=o(r(ye),2),Pe=r(ze),Je=o(r(Pe),2),J=r(Je);H(J);var Ve=o(J,2),St=r(Ve);i(Ve),i(Je),i(Pe);var Se=o(Pe,2),Ye=r(Se);H(Ye),W(2),i(Se);var Qe=o(Se,2),ae=r(Qe),kt=r(ae,!0);i(ae),i(Qe),i(ze),i(ye);var ke=o(ye,2),We=o(r(ke),2),xe=r(We),Xe=o(r(xe),2),xt=r(Xe,!0);i(Xe),i(xe);var Ie=o(xe,2),Ze=o(r(Ie),2),It=r(Ze,!0);i(Ze),i(Ie);var et=o(Ie,2),we=r(et),wt=o(we,2);i(et),i(We),i(ke);var tt=o(ke,2),at=o(r(tt),2),$t=r(at);aa($t,{}),i(at),i(tt),i(De),i(oe),Ae(a=>{var d;O(yt,e(y)?"Edit Profile":"New Profile"),pe.disabled=(e(t),e(s),_(()=>e(t).savingProfile||!e(s).emulatorId)),te.disabled=(e(t),_(()=>e(t).savingProfile)),O(Pt,(e(t),_(()=>e(t).savingProfile?"Saving...":"Save"))),be.disabled=(e(s),_(()=>!e(s).useOverride)),G(J,"min",(e(t),_(()=>e(t).retentionBounds[0]))),G(J,"max",(e(t),_(()=>e(t).retentionBounds[1]))),O(St,"".concat((d=e(T))!=null?d:""," versions")),ae.disabled=(e(t),_(()=>e(t).savingSettings)),O(kt,(e(t),_(()=>e(t).savingSettings?"Saving...":"Save changes"))),O(xt,(e(t),_(()=>{var p,P;return(P=(p=e(t).storageInfo)==null?void 0:p.history_path)!=null?P:"-"}))),O(It,a),we.disabled=(e(t),_(()=>!e(t).storageInfo))},[()=>(e(t),_(()=>{var a,d;return e(t).loadingStorage?"Calculating...":le((d=(a=e(t).storageInfo)==null?void 0:a.size_bytes)!=null?d:0)}))]),w("click",gt,k),w("click",Me,ee),w("click",pe,Z),w("click",te,j),q(Ue,()=>e(s).name,a=>L(s,e(s).name=a)),q(Le,()=>e(s).emulatorId,a=>L(s,e(s).emulatorId=a)),q(qe,()=>e(s).savePath,a=>L(s,e(s).savePath=a)),q(Ge,()=>e(s).patterns,a=>L(s,e(s).patterns=a)),ot(je,()=>e(s).useOverride,a=>L(s,e(s).useOverride=a)),q(be,()=>e(s).overridePath,a=>L(s,e(s).overridePath=a)),q(J,()=>e(T),a=>b(T,a)),ot(Ye,()=>e(C),a=>b(C,a)),w("click",ae,mt),w("click",we,R),w("click",wt,()=>I.clearHistory()),M(u,oe),dt(),A()}export{Sa as component};
