var Dt=Object.defineProperty,Et=Object.defineProperties;var Ct=Object.getOwnPropertyDescriptors;var it=Object.getOwnPropertySymbols;var Ht=Object.prototype.hasOwnProperty,Rt=Object.prototype.propertyIsEnumerable;var rt=(u,l,v)=>l in u?Dt(u,l,{enumerable:!0,configurable:!0,writable:!0,value:v}):u[l]=v,g=(u,l)=>{for(var v in l||(l={}))Ht.call(l,v)&&rt(u,v,l[v]);if(it)for(var v of it(l))Rt.call(l,v)&&rt(u,v,l[v]);return u},h=(u,l)=>Et(u,Ct(l));var y=(u,l,v)=>new Promise((x,A)=>{var t=f=>{try{F(v.next(f))}catch(s){A(s)}},P=f=>{try{F(v.throw(f))}catch(s){A(s)}},F=f=>f.done?x(f.value):Promise.resolve(f.value).then(t,P);F((v=v.apply(u,l)).next())});import{f as L,a as N,c as Nt}from"../chunks/Ddp4388f.js";import{i as nt}from"../chunks/C4OmZW64.js";import{n as ct,o as vt,v as Ae,s as dt,V as b,R as M,z as n,x as r,y as i,i as e,w as Mt,aI as Q,aJ as Ut,u as _,aK as U,A as W,q as qt}from"../chunks/CaUR0xkT.js";import{e as $,s as O}from"../chunks/DRdTxxXw.js";import{s as ut,a as Fe,i as lt}from"../chunks/CrMNZ0Ye.js";import{i as Kt,s as K,a as re,g as Lt,p as D,c as Gt,b as ie,u as Jt,d as jt,e as Vt,l as Yt,f as Qt,A as Wt,r as C,h as Xt,j as Zt}from"../chunks/9bikLB0Z.js";import{b as q,a as ot}from"../chunks/CTp4dbcY.js";import{g as ea}from"../chunks/BSO6eAg8.js";import{t as X}from"../chunks/n9JGGUtD.js";function ta(u,l){return y(this,null,function*(){yield Kt("plugin:opener|open_path",{path:u,with:l})})}var aa=L('<section class="panel svelte-wokkaz"><div class="section-header svelte-wokkaz"><p class="label svelte-wokkaz">Theme</p> <span class="hint svelte-wokkaz">Applies instantly</span></div> <div class="segmented svelte-wokkaz" role="group" aria-label="Theme selector"><button>Light</button> <button>Dark</button> <button>System</button></div> <div class="status svelte-wokkaz"><span class="dot svelte-wokkaz" aria-hidden="true"></span> <p> </p></div></section>');function sa(u,l){ct(l,!1);const v=()=>Fe(P,"$themePreference",A),x=()=>Fe(F,"$activeTheme",A),[A,t]=ut(),P=X.preference,F=X.activeTheme;let f=M(!1);vt(()=>{if(typeof localStorage!="undefined"){const R=localStorage.getItem("ui-theme");b(f,R==="light"||R==="dark")}});function s(){b(f,!0),X.setTheme("light")}function z(){b(f,!0),X.setTheme("dark")}function E(){b(f,!1),X.setTheme("system")}nt();var B=aa(),c=n(r(B),2),o=r(c);let m;var k=n(o,2);let H;var G=n(k,2);let Z;i(c);var ee=n(c,2),J=n(r(ee),2),le=r(J);i(J),i(ee),i(B),Ae(()=>{var R;K(o,"aria-pressed",v()==="light"),m=re(o,1,"svelte-wokkaz",null,m,{active:v()==="light"}),K(k,"aria-pressed",v()==="dark"),H=re(k,1,"svelte-wokkaz",null,H,{active:v()==="dark"}),K(G,"aria-pressed",v()==="system"),Z=re(G,1,"svelte-wokkaz",null,Z,{active:v()==="system"}),O(le,"Current theme: ".concat((R=x())!=null?R:"").concat(e(f)?" (manual)":" (system)"))}),$("click",o,s),$("click",k,z),$("click",G,E),N(u,B),dt(),t()}const pt="save-path-overrides",ft=typeof window!="undefined";function ia(){if(!ft)return{};try{const u=localStorage.getItem(pt);return u?JSON.parse(u):{}}catch(u){return console.warn("Unable to read overrides",u),{}}}function ra(u){if(ft)try{localStorage.setItem(pt,JSON.stringify(u))}catch(l){console.warn("Unable to persist overrides",l)}}function la(){const{subscribe:u,update:l,set:v}=Mt({profiles:[],loadingProfiles:!1,selectedProfileId:null,overrides:ia(),appSettings:null,storageInfo:null,loadingStorage:!1,savingSettings:!1,savingProfile:!1,retentionBounds:[5,20]});function x(){return y(this,null,function*(){l(c=>h(g({},c),{loadingProfiles:!0}));try{const c=yield Yt();l(o=>{var m,k,H;return h(g({},o),{profiles:c,loadingProfiles:!1,selectedProfileId:(H=(k=o.selectedProfileId)!=null?k:(m=c[0])==null?void 0:m.emulator_id)!=null?H:null})})}catch(c){l(o=>h(g({},o),{loadingProfiles:!1})),D("Failed to load profiles: ".concat(c))}})}function A(){return y(this,null,function*(){try{const c=yield Qt();l(o=>h(g({},o),{appSettings:c}))}catch(c){D("Failed to load settings: ".concat(c))}})}function t(){return y(this,null,function*(){l(c=>h(g({},c),{loadingStorage:!0}));try{const c=yield Lt();l(o=>h(g({},o),{storageInfo:c,loadingStorage:!1,retentionBounds:c.retention_bounds}))}catch(c){l(o=>h(g({},o),{loadingStorage:!1})),D("Failed to fetch storage info: ".concat(c))}})}function P(c){return y(this,null,function*(){l(o=>h(g({},o),{savingProfile:!0}));try{const o=yield Vt(c);ie("Saved profile ".concat(o.name)),yield x(),l(m=>h(g({},m),{selectedProfileId:o.emulator_id,savingProfile:!1}))}catch(o){l(m=>h(g({},m),{savingProfile:!1})),D("Failed to save profile: ".concat(o))}})}function F(c){return y(this,null,function*(){l(o=>h(g({},o),{savingProfile:!0}));try{yield jt(c),ie("Deleted profile ".concat(c)),yield x(),l(o=>h(g({},o),{savingProfile:!1,selectedProfileId:null}))}catch(o){l(m=>h(g({},m),{savingProfile:!1})),D("Failed to delete profile: ".concat(o))}})}function f(c){return y(this,null,function*(){l(o=>h(g({},o),{savingSettings:!0}));try{const o=yield Jt(c);l(m=>h(g({},m),{appSettings:o,savingSettings:!1})),ie("Settings updated"),yield t()}catch(o){l(m=>h(g({},m),{savingSettings:!1})),D("Failed to update settings: ".concat(o))}})}function s(){return y(this,null,function*(){try{yield Gt(),ie("History cache cleared"),yield t()}catch(c){D("Unable to clear history cache: ".concat(c))}})}function z(c,o){l(m=>{const k=h(g({},m.overrides),{[c]:o});return ra(k),h(g({},m),{overrides:k})})}function E(c){l(o=>h(g({},o),{selectedProfileId:c}))}function B(){return y(this,null,function*(){yield Promise.all([x(),A(),t()])})}return{subscribe:u,load:B,refreshProfiles:x,saveProfile:P,deleteProfile:F,applySettings:f,clearHistory:s,setOverride:z,setSelectedProfile:E,refreshStorage:t,setState:v}}const I=la();var oa=L('<p class="muted svelte-1i19ct2">Loading profiles...</p>'),na=L('<p class="muted svelte-1i19ct2">No profiles found.</p>'),ca=L('<button><div><p class="label svelte-1i19ct2"> </p> <p class="id svelte-1i19ct2"> </p></div> <p class="path svelte-1i19ct2"> </p></button>'),va=L('<div class="cards svelte-1i19ct2"></div>'),da=L('<section class="settings svelte-1i19ct2"><!> <div class="accordion-stack svelte-1i19ct2"><details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Profiles</p> <h2 class="svelte-1i19ct2">Emulator Profiles</h2></div> <span class="hint svelte-1i19ct2">Manage emulator save paths</span></summary> <div class="accordion-body svelte-1i19ct2"><div class="profile-grid svelte-1i19ct2"><div class="profile-list svelte-1i19ct2"><div class="list-header svelte-1i19ct2"><p class="section-title svelte-1i19ct2">Loaded Profiles</p> <button class="ghost svelte-1i19ct2">Add Profile</button></div> <!></div> <div class="profile-form svelte-1i19ct2"><div class="form-header svelte-1i19ct2"><div><p class="section-title svelte-1i19ct2"> </p> <p class="muted svelte-1i19ct2">Configure emulator metadata and save paths.</p></div> <div class="actions svelte-1i19ct2"><button class="ghost svelte-1i19ct2">Cancel</button> <button class="secondary svelte-1i19ct2">Delete</button> <button class="primary svelte-1i19ct2"> </button></div></div> <div class="field-group svelte-1i19ct2"><label for="name" class="svelte-1i19ct2">Name</label> <input id="name" placeholder="RetroArch" autocomplete="off" class="svelte-1i19ct2"/></div> <div class="field-group svelte-1i19ct2"><label for="emulatorId" class="svelte-1i19ct2">Emulator ID</label> <input id="emulatorId" placeholder="retroarch" autocomplete="off" class="svelte-1i19ct2"/></div> <div class="field-group svelte-1i19ct2"><label for="savePath" class="svelte-1i19ct2">Save path</label> <input id="savePath" placeholder="~/saves/retroarch" class="svelte-1i19ct2"/> <p class="muted svelte-1i19ct2">Used as the default path unless override is enabled.</p></div> <div class="field-group svelte-1i19ct2"><label for="patterns" class="svelte-1i19ct2">Glob patterns</label> <input id="patterns" placeholder="*.sav, *.srm, *.state" class="svelte-1i19ct2"/> <p class="muted svelte-1i19ct2">Comma or newline separated patterns.</p></div> <div class="override-row svelte-1i19ct2"><label class="toggle svelte-1i19ct2"><input type="checkbox" class="svelte-1i19ct2"/> <span>Override save path</span></label> <input placeholder="/custom/path/to/saves" class="override-input svelte-1i19ct2" aria-label="Override path"/></div></div></div></div></details> <details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Backups</p> <h2 class="svelte-1i19ct2">Backup Retention</h2></div> <span class="hint svelte-1i19ct2">Keep your versions tidy</span></summary> <div class="accordion-body retention svelte-1i19ct2"><div class="field-group inline svelte-1i19ct2"><label for="retentionRange" class="svelte-1i19ct2">Versions to keep</label> <div class="range-row svelte-1i19ct2"><input type="range" id="retentionRange" class="svelte-1i19ct2"/> <span class="value svelte-1i19ct2"> </span></div></div> <label class="toggle svelte-1i19ct2"><input type="checkbox" class="svelte-1i19ct2"/> <span>Auto delete old versions</span></label> <div class="actions svelte-1i19ct2"><button class="primary svelte-1i19ct2"> </button></div></div></details> <details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Storage</p> <h2 class="svelte-1i19ct2">App Storage</h2></div> <span class="hint svelte-1i19ct2">History cache and folders</span></summary> <div class="accordion-body storage svelte-1i19ct2"><div class="stat svelte-1i19ct2"><p class="label svelte-1i19ct2">History folder</p> <p class="value svelte-1i19ct2"> </p></div> <div class="stat svelte-1i19ct2"><p class="label svelte-1i19ct2">Current size</p> <p class="value svelte-1i19ct2"> </p></div> <div class="actions svelte-1i19ct2"><button class="secondary svelte-1i19ct2">Open storage folder</button> <button class="primary svelte-1i19ct2">Clear all history cache</button></div></div></details> <details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Appearance</p> <h2 class="svelte-1i19ct2">Theme</h2></div> <span class="hint svelte-1i19ct2">Dark or light</span></summary> <div class="accordion-body svelte-1i19ct2"><!></div></details></div></section>');function Sa(u,l){ct(l,!1);const v=()=>Fe(I,"$settingsStore",x),[x,A]=ut(),t=M(),P=M(),F="*.sav, *.srm, *.state",f=()=>({name:"",emulatorId:"",savePath:"",patterns:F,useOverride:!1,overridePath:""});let s=M(f()),z=M(10),E=M(!0),B=M(null);function c(){ea("/",{keepFocus:!0,noScroll:!0})}vt(()=>{I.load()});function o(a,d){var S,se,T;const p=d[a.emulator_id];return{name:a.name,emulatorId:a.emulator_id,savePath:(S=a.default_save_paths[0])!=null?S:"",patterns:a.file_patterns.join(", "),useOverride:(se=p==null?void 0:p.enabled)!=null?se:!1,overridePath:(T=p==null?void 0:p.path)!=null?T:""}}function m(a){I.setSelectedProfile(a.emulator_id)}function k(){I.setSelectedProfile(null),b(B,null),b(s,f())}function H(){return e(s).name.trim()?e(s).emulatorId.trim()?e(s).savePath.trim()?e(s).patterns.split(/[,\n]/).map(d=>d.trim()).filter(Boolean).length===0?"Please provide at least one glob pattern":null:"Save path is required":"Emulator ID is required":"Name is required"}function G(){return y(this,null,function*(){const a=H();if(a){D(a);return}const d=e(s).patterns.split(/[,\n]/).map(S=>S.trim()).filter(Boolean),p={emulator_id:e(s).emulatorId.trim(),name:e(s).name.trim(),default_save_paths:[e(s).savePath.trim()],file_patterns:d};yield I.saveProfile(p),I.setOverride(p.emulator_id,{enabled:e(s).useOverride,path:e(s).overridePath.trim()})})}function Z(){return y(this,null,function*(){if(!e(s).emulatorId){b(s,f());return}yield I.deleteProfile(e(s).emulatorId)})}function ee(){if(e(P)){b(s,o(e(P),e(t).overrides));return}b(s,f())}function J(a){var p;const d=e(t).overrides[a.emulator_id];return d!=null&&d.enabled&&d.path.trim()?d.path.trim():(p=a.default_save_paths[0])!=null?p:""}function le(a){if(!a)return"0 B";const d=["B","KB","MB","GB"];let p=a,S=0;for(;p>=1024&&S<d.length-1;)p/=1024,S+=1;return"".concat(p.toFixed(p>=10?0:1)," ").concat(d[S])}function R(){return y(this,null,function*(){if(e(t).storageInfo)try{yield ta(e(t).storageInfo.history_path)}catch(a){D("Unable to open storage: ".concat(a))}})}function mt(){return y(this,null,function*(){e(t).appSettings&&(yield I.applySettings({retention_limit:e(z),auto_delete:e(E)}))})}Q(()=>v(),()=>{b(t,v())}),Q(()=>(e(t),I),()=>{!e(t).selectedProfileId&&e(t).profiles.length>0&&I.setSelectedProfile(e(t).profiles[0].emulator_id)}),Q(()=>e(t),()=>{var a;b(P,(a=e(t).profiles.find(d=>d.emulator_id===e(t).selectedProfileId))!=null?a:null)}),Q(()=>e(t),()=>{e(t).appSettings&&(b(z,e(t).appSettings.retention_limit),b(E,e(t).appSettings.auto_delete))}),Q(()=>(e(t),e(B),e(P)),()=>{e(t).selectedProfileId!==e(B)&&(b(B,e(t).selectedProfileId),e(P)?b(s,o(e(P),e(t).overrides)):b(s,f()))}),Ut(),nt();var oe=da(),ze=r(oe);Wt(ze,{title:"Settings",showBack:!0,onBack:c,onMenu:()=>{},sticky:!1});var Te=n(ze,2),ne=r(Te),De=n(r(ne),2),Ee=r(De),ce=r(Ee),ve=r(ce),gt=n(r(ve),2);i(ve);var ht=n(ve,2);{var _t=a=>{var d=oa();N(a,d)},bt=a=>{var d=Nt(),p=qt(d);{var S=T=>{var V=na();N(T,V)},se=T=>{var V=va();Xt(V,5,()=>(e(t),_(()=>e(t).profiles)),Zt,(Bt,w)=>{var Y=ca(),xe=r(Y),Be=r(xe),Ot=r(Be,!0);i(Be);var st=n(Be,2),At=r(st,!0);i(st),i(xe);var Oe=n(xe,2),Ft=r(Oe,!0);i(Oe),i(Y),Ae((zt,Tt)=>{re(Y,1,(e(t),e(w),_(()=>"card ".concat(e(t).selectedProfileId===e(w).emulator_id?"active":""))),"svelte-1i19ct2"),O(Ot,(e(w),_(()=>e(w).name))),O(At,(e(w),_(()=>e(w).emulator_id))),K(Oe,"title",zt),O(Ft,Tt)},[()=>(e(w),_(()=>J(e(w)))),()=>(e(w),_(()=>J(e(w))))]),$("click",Y,()=>m(e(w))),N(Bt,Y)}),i(V),N(T,V)};lt(p,T=>{e(t),_(()=>e(t).profiles.length===0)?T(S):T(se,!1)},!0)}N(a,d)};lt(ht,a=>{e(t),_(()=>e(t).loadingProfiles)?a(_t):a(bt,!1)})}i(ce);var Ce=n(ce,2),de=r(Ce),ue=r(de),He=r(ue),yt=r(He,!0);i(He),W(2),i(ue);var Re=n(ue,2),Ne=r(Re),pe=n(Ne,2),te=n(pe,2),Pt=r(te,!0);i(te),i(Re),i(de);var fe=n(de,2),Me=n(r(fe),2);C(Me),i(fe);var me=n(fe,2),Ue=n(r(me),2);C(Ue),i(me);var ge=n(me,2),qe=n(r(ge),2);C(qe),W(2),i(ge);var he=n(ge,2),Ke=n(r(he),2);C(Ke),W(2),i(he);var Le=n(he,2),_e=r(Le),Ge=r(_e);C(Ge),W(2),i(_e);var be=n(_e,2);C(be),i(Le),i(Ce),i(Ee),i(De),i(ne);var ye=n(ne,2),Je=n(r(ye),2),Pe=r(Je),je=n(r(Pe),2),j=r(je);C(j);var Ve=n(j,2),St=r(Ve);i(Ve),i(je),i(Pe);var Se=n(Pe,2),Ye=r(Se);C(Ye),W(2),i(Se);var Qe=n(Se,2),ae=r(Qe),kt=r(ae,!0);i(ae),i(Qe),i(Je),i(ye);var ke=n(ye,2),We=n(r(ke),2),we=r(We),Xe=n(r(we),2),wt=r(Xe,!0);i(Xe),i(we);var Ie=n(we,2),Ze=n(r(Ie),2),It=r(Ze,!0);i(Ze),i(Ie);var et=n(Ie,2),$e=r(et),$t=n($e,2);i(et),i(We),i(ke);var tt=n(ke,2),at=n(r(tt),2),xt=r(at);sa(xt,{}),i(at),i(tt),i(Te),i(oe),Ae(a=>{var d;O(yt,e(P)?"Edit Profile":"New Profile"),pe.disabled=(e(t),e(s),_(()=>e(t).savingProfile||!e(s).emulatorId)),te.disabled=(e(t),_(()=>e(t).savingProfile)),O(Pt,(e(t),_(()=>e(t).savingProfile?"Saving...":"Save"))),be.disabled=(e(s),_(()=>!e(s).useOverride)),K(j,"min",(e(t),_(()=>e(t).retentionBounds[0]))),K(j,"max",(e(t),_(()=>e(t).retentionBounds[1]))),O(St,"".concat((d=e(z))!=null?d:""," versions")),ae.disabled=(e(t),_(()=>e(t).savingSettings)),O(kt,(e(t),_(()=>e(t).savingSettings?"Saving...":"Save changes"))),O(wt,(e(t),_(()=>{var p,S;return(S=(p=e(t).storageInfo)==null?void 0:p.history_path)!=null?S:"-"}))),O(It,a),$e.disabled=(e(t),_(()=>!e(t).storageInfo))},[()=>(e(t),_(()=>{var a,d;return e(t).loadingStorage?"Calculating...":le((d=(a=e(t).storageInfo)==null?void 0:a.size_bytes)!=null?d:0)}))]),$("click",gt,k),$("click",Ne,ee),$("click",pe,Z),$("click",te,G),q(Me,()=>e(s).name,a=>U(s,e(s).name=a)),q(Ue,()=>e(s).emulatorId,a=>U(s,e(s).emulatorId=a)),q(qe,()=>e(s).savePath,a=>U(s,e(s).savePath=a)),q(Ke,()=>e(s).patterns,a=>U(s,e(s).patterns=a)),ot(Ge,()=>e(s).useOverride,a=>U(s,e(s).useOverride=a)),q(be,()=>e(s).overridePath,a=>U(s,e(s).overridePath=a)),q(j,()=>e(z),a=>b(z,a)),ot(Ye,()=>e(E),a=>b(E,a)),$("click",ae,mt),$("click",$e,R),$("click",$t,()=>I.clearHistory()),N(u,oe),dt(),A()}export{Sa as component};
