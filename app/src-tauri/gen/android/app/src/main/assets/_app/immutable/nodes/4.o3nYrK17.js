var Nt=Object.defineProperty,Ht=Object.defineProperties;var Rt=Object.getOwnPropertyDescriptors;var lt=Object.getOwnPropertySymbols;var Mt=Object.prototype.hasOwnProperty,Ut=Object.prototype.propertyIsEnumerable;var ot=(u,l,v)=>l in u?Nt(u,l,{enumerable:!0,configurable:!0,writable:!0,value:v}):u[l]=v,g=(u,l)=>{for(var v in l||(l={}))Mt.call(l,v)&&ot(u,v,l[v]);if(lt)for(var v of lt(l))Ut.call(l,v)&&ot(u,v,l[v]);return u},h=(u,l)=>Ht(u,Rt(l));var y=(u,l,v)=>new Promise((x,A)=>{var t=f=>{try{F(v.next(f))}catch(s){A(s)}},P=f=>{try{F(v.throw(f))}catch(s){A(s)}},F=f=>f.done?x(f.value):Promise.resolve(f.value).then(t,P);F((v=v.apply(u,l)).next())});import{f as L,a as R,c as qt}from"../chunks/BFGhZlYr.js";import{i as dt}from"../chunks/BhH20qZN.js";import{n as ut,A as pt,q as Oe,s as ft,V as b,R as M,y as n,v as r,x as i,i as e,w as Kt,aI as Q,aJ as Lt,o as nt,u as _,aK as U,z as W}from"../chunks/DYAuyVG6.js";import{e as $,s as O}from"../chunks/B9GUTLQ3.js";import{s as mt,a as Ae,i as ct}from"../chunks/D5a-4jpI.js";import{i as Gt,s as K,a as re,g as Jt,p as D,c as jt,b as ie,u as Vt,d as Yt,e as Qt,l as Wt,f as Xt,A as Zt,r as C,h as ea,j as ta}from"../chunks/D45miUB6.js";import{b as q,a as vt}from"../chunks/-e0yHRBY.js";import{g as aa}from"../chunks/BPfvFz2G.js";import{t as X}from"../chunks/H9XTCfS1.js";import{N as sa}from"../chunks/CaiTVN3W.js";function ia(u,l){return y(this,null,function*(){yield Gt("plugin:opener|open_path",{path:u,with:l})})}var ra=L('<section class="panel svelte-wokkaz"><div class="section-header svelte-wokkaz"><p class="label svelte-wokkaz">Theme</p> <span class="hint svelte-wokkaz">Applies instantly</span></div> <div class="segmented svelte-wokkaz" role="group" aria-label="Theme selector"><button>Light</button> <button>Dark</button> <button>System</button></div> <div class="status svelte-wokkaz"><span class="dot svelte-wokkaz" aria-hidden="true"></span> <p> </p></div></section>');function la(u,l){ut(l,!1);const v=()=>Ae(P,"$themePreference",A),x=()=>Ae(F,"$activeTheme",A),[A,t]=mt(),P=X.preference,F=X.activeTheme;let f=M(!1);pt(()=>{if(typeof localStorage!="undefined"){const H=localStorage.getItem("ui-theme");b(f,H==="light"||H==="dark")}});function s(){b(f,!0),X.setTheme("light")}function z(){b(f,!0),X.setTheme("dark")}function E(){b(f,!1),X.setTheme("system")}dt();var B=ra(),c=n(r(B),2),o=r(c);let m;var k=n(o,2);let N;var G=n(k,2);let Z;i(c);var ee=n(c,2),J=n(r(ee),2),le=r(J);i(J),i(ee),i(B),Oe(()=>{var H;K(o,"aria-pressed",v()==="light"),m=re(o,1,"svelte-wokkaz",null,m,{active:v()==="light"}),K(k,"aria-pressed",v()==="dark"),N=re(k,1,"svelte-wokkaz",null,N,{active:v()==="dark"}),K(G,"aria-pressed",v()==="system"),Z=re(G,1,"svelte-wokkaz",null,Z,{active:v()==="system"}),O(le,"Current theme: ".concat((H=x())!=null?H:"").concat(e(f)?" (manual)":" (system)"))}),$("click",o,s),$("click",k,z),$("click",G,E),R(u,B),ft(),t()}const gt="save-path-overrides",ht=typeof window!="undefined";function oa(){if(!ht)return{};try{const u=localStorage.getItem(gt);return u?JSON.parse(u):{}}catch(u){return console.warn("Unable to read overrides",u),{}}}function na(u){if(ht)try{localStorage.setItem(gt,JSON.stringify(u))}catch(l){console.warn("Unable to persist overrides",l)}}function ca(){const{subscribe:u,update:l,set:v}=Kt({profiles:[],loadingProfiles:!1,selectedProfileId:null,overrides:oa(),appSettings:null,storageInfo:null,loadingStorage:!1,savingSettings:!1,savingProfile:!1,retentionBounds:[5,20]});function x(){return y(this,null,function*(){l(c=>h(g({},c),{loadingProfiles:c.profiles.length===0}));try{const c=yield Wt();l(o=>{var m,k,N;return h(g({},o),{profiles:c,loadingProfiles:!1,selectedProfileId:(N=(k=o.selectedProfileId)!=null?k:(m=c[0])==null?void 0:m.emulator_id)!=null?N:null})})}catch(c){l(o=>h(g({},o),{loadingProfiles:!1})),D("Failed to load profiles: ".concat(c))}})}function A(){return y(this,null,function*(){try{const c=yield Xt();l(o=>h(g({},o),{appSettings:c}))}catch(c){D("Failed to load settings: ".concat(c))}})}function t(){return y(this,null,function*(){l(c=>h(g({},c),{loadingStorage:!0}));try{const c=yield Jt();l(o=>h(g({},o),{storageInfo:c,loadingStorage:!1,retentionBounds:c.retention_bounds}))}catch(c){l(o=>h(g({},o),{loadingStorage:!1})),D("Failed to fetch storage info: ".concat(c))}})}function P(c){return y(this,null,function*(){l(o=>h(g({},o),{savingProfile:!0}));try{const o=yield Qt(c);ie("Saved profile ".concat(o.name)),yield x(),l(m=>h(g({},m),{selectedProfileId:o.emulator_id,savingProfile:!1}))}catch(o){l(m=>h(g({},m),{savingProfile:!1})),D("Failed to save profile: ".concat(o))}})}function F(c){return y(this,null,function*(){l(o=>h(g({},o),{savingProfile:!0}));try{yield Yt(c),ie("Deleted profile ".concat(c)),yield x(),l(o=>h(g({},o),{savingProfile:!1,selectedProfileId:null}))}catch(o){l(m=>h(g({},m),{savingProfile:!1})),D("Failed to delete profile: ".concat(o))}})}function f(c){return y(this,null,function*(){l(o=>h(g({},o),{savingSettings:!0}));try{const o=yield Vt(c);l(m=>h(g({},m),{appSettings:o,savingSettings:!1})),ie("Settings updated"),yield t()}catch(o){l(m=>h(g({},m),{savingSettings:!1})),D("Failed to update settings: ".concat(o))}})}function s(){return y(this,null,function*(){try{yield jt(),ie("History cache cleared"),yield t()}catch(c){D("Unable to clear history cache: ".concat(c))}})}function z(c,o){l(m=>{const k=h(g({},m.overrides),{[c]:o});return na(k),h(g({},m),{overrides:k})})}function E(c){l(o=>h(g({},o),{selectedProfileId:c}))}function B(){return y(this,null,function*(){yield Promise.all([x(),A(),t()])})}return{subscribe:u,load:B,refreshProfiles:x,saveProfile:P,deleteProfile:F,applySettings:f,clearHistory:s,setOverride:z,setSelectedProfile:E,refreshStorage:t,setState:v}}const I=ca();var va=L('<p class="muted svelte-1i19ct2">Loading profiles...</p>'),da=L('<p class="muted svelte-1i19ct2">No profiles found.</p>'),ua=L('<button><div><p class="label svelte-1i19ct2"> </p> <p class="id svelte-1i19ct2"> </p></div> <p class="path svelte-1i19ct2"> </p></button>'),pa=L('<div class="cards svelte-1i19ct2"></div>'),fa=L('<!> <section class="settings svelte-1i19ct2"><!> <div class="accordion-stack svelte-1i19ct2"><details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Profiles</p> <h2 class="svelte-1i19ct2">Emulator Profiles</h2></div> <span class="hint svelte-1i19ct2">Manage emulator save paths</span></summary> <div class="accordion-body svelte-1i19ct2"><div class="profile-grid svelte-1i19ct2"><div class="profile-list svelte-1i19ct2"><div class="list-header svelte-1i19ct2"><p class="section-title svelte-1i19ct2">Loaded Profiles</p> <button class="ghost svelte-1i19ct2">Add Profile</button></div> <!></div> <div class="profile-form svelte-1i19ct2"><div class="form-header svelte-1i19ct2"><div><p class="section-title svelte-1i19ct2"> </p> <p class="muted svelte-1i19ct2">Configure emulator metadata and save paths.</p></div> <div class="actions svelte-1i19ct2"><button class="ghost svelte-1i19ct2">Cancel</button> <button class="secondary svelte-1i19ct2">Delete</button> <button class="primary svelte-1i19ct2"> </button></div></div> <div class="field-group svelte-1i19ct2"><label for="name" class="svelte-1i19ct2">Name</label> <input id="name" placeholder="RetroArch" autocomplete="off" class="svelte-1i19ct2"/></div> <div class="field-group svelte-1i19ct2"><label for="emulatorId" class="svelte-1i19ct2">Emulator ID</label> <input id="emulatorId" placeholder="retroarch" autocomplete="off" class="svelte-1i19ct2"/></div> <div class="field-group svelte-1i19ct2"><label for="savePath" class="svelte-1i19ct2">Save path</label> <input id="savePath" placeholder="~/saves/retroarch" class="svelte-1i19ct2"/> <p class="muted svelte-1i19ct2">Used as the default path unless override is enabled.</p></div> <div class="field-group svelte-1i19ct2"><label for="patterns" class="svelte-1i19ct2">Glob patterns</label> <input id="patterns" placeholder="*.sav, *.srm, *.state" class="svelte-1i19ct2"/> <p class="muted svelte-1i19ct2">Comma or newline separated patterns.</p></div> <div class="override-row svelte-1i19ct2"><label class="toggle svelte-1i19ct2"><input type="checkbox" class="svelte-1i19ct2"/> <span>Override save path</span></label> <input placeholder="/custom/path/to/saves" class="override-input svelte-1i19ct2" aria-label="Override path"/></div></div></div></div></details> <details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Backups</p> <h2 class="svelte-1i19ct2">Backup Retention</h2></div> <span class="hint svelte-1i19ct2">Keep your versions tidy</span></summary> <div class="accordion-body retention svelte-1i19ct2"><div class="field-group inline svelte-1i19ct2"><label for="retentionRange" class="svelte-1i19ct2">Versions to keep</label> <div class="range-row svelte-1i19ct2"><input type="range" id="retentionRange" class="svelte-1i19ct2"/> <span class="value svelte-1i19ct2"> </span></div></div> <label class="toggle svelte-1i19ct2"><input type="checkbox" class="svelte-1i19ct2"/> <span>Auto delete old versions</span></label> <div class="actions svelte-1i19ct2"><button class="primary svelte-1i19ct2"> </button></div></div></details> <details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Storage</p> <h2 class="svelte-1i19ct2">App Storage</h2></div> <span class="hint svelte-1i19ct2">History cache and folders</span></summary> <div class="accordion-body storage svelte-1i19ct2"><div class="stat svelte-1i19ct2"><p class="label svelte-1i19ct2">History folder</p> <p class="value svelte-1i19ct2"> </p></div> <div class="stat svelte-1i19ct2"><p class="label svelte-1i19ct2">Current size</p> <p class="value svelte-1i19ct2"> </p></div> <div class="actions svelte-1i19ct2"><button class="secondary svelte-1i19ct2">Open storage folder</button> <button class="primary svelte-1i19ct2">Clear all history cache</button></div></div></details> <details open class="accordion svelte-1i19ct2"><summary class="svelte-1i19ct2"><div><p class="eyebrow svelte-1i19ct2">Appearance</p> <h2 class="svelte-1i19ct2">Theme</h2></div> <span class="hint svelte-1i19ct2">Dark or light</span></summary> <div class="accordion-body svelte-1i19ct2"><!></div></details></div></section>',1);function $a(u,l){ut(l,!1);const v=()=>Ae(I,"$settingsStore",x),[x,A]=mt(),t=M(),P=M(),F="*.sav, *.srm, *.state",f=()=>({name:"",emulatorId:"",savePath:"",patterns:F,useOverride:!1,overridePath:""});let s=M(f()),z=M(10),E=M(!0),B=M(null);function c(){aa("/",{keepFocus:!0,noScroll:!0})}pt(()=>{I.load()});function o(a,d){var S,se,T;const p=d[a.emulator_id];return{name:a.name,emulatorId:a.emulator_id,savePath:(S=a.default_save_paths[0])!=null?S:"",patterns:a.file_patterns.join(", "),useOverride:(se=p==null?void 0:p.enabled)!=null?se:!1,overridePath:(T=p==null?void 0:p.path)!=null?T:""}}function m(a){I.setSelectedProfile(a.emulator_id)}function k(){I.setSelectedProfile(null),b(B,null),b(s,f())}function N(){return e(s).name.trim()?e(s).emulatorId.trim()?e(s).savePath.trim()?e(s).patterns.split(/[,\n]/).map(d=>d.trim()).filter(Boolean).length===0?"Please provide at least one glob pattern":null:"Save path is required":"Emulator ID is required":"Name is required"}function G(){return y(this,null,function*(){const a=N();if(a){D(a);return}const d=e(s).patterns.split(/[,\n]/).map(S=>S.trim()).filter(Boolean),p={emulator_id:e(s).emulatorId.trim(),name:e(s).name.trim(),default_save_paths:[e(s).savePath.trim()],file_patterns:d};yield I.saveProfile(p),I.setOverride(p.emulator_id,{enabled:e(s).useOverride,path:e(s).overridePath.trim()})})}function Z(){return y(this,null,function*(){if(!e(s).emulatorId){b(s,f());return}yield I.deleteProfile(e(s).emulatorId)})}function ee(){if(e(P)){b(s,o(e(P),e(t).overrides));return}b(s,f())}function J(a){var p;const d=e(t).overrides[a.emulator_id];return d!=null&&d.enabled&&d.path.trim()?d.path.trim():(p=a.default_save_paths[0])!=null?p:""}function le(a){if(!a)return"0 B";const d=["B","KB","MB","GB"];let p=a,S=0;for(;p>=1024&&S<d.length-1;)p/=1024,S+=1;return"".concat(p.toFixed(p>=10?0:1)," ").concat(d[S])}function H(){return y(this,null,function*(){if(e(t).storageInfo)try{yield ia(e(t).storageInfo.history_path)}catch(a){D("Unable to open storage: ".concat(a))}})}function _t(){return y(this,null,function*(){e(t).appSettings&&(yield I.applySettings({retention_limit:e(z),auto_delete:e(E)}))})}Q(()=>v(),()=>{b(t,v())}),Q(()=>(e(t),I),()=>{!e(t).selectedProfileId&&e(t).profiles.length>0&&I.setSelectedProfile(e(t).profiles[0].emulator_id)}),Q(()=>e(t),()=>{var a;b(P,(a=e(t).profiles.find(d=>d.emulator_id===e(t).selectedProfileId))!=null?a:null)}),Q(()=>e(t),()=>{e(t).appSettings&&(b(z,e(t).appSettings.retention_limit),b(E,e(t).appSettings.auto_delete))}),Q(()=>(e(t),e(B),e(P)),()=>{e(t).selectedProfileId!==e(B)&&(b(B,e(t).selectedProfileId),e(P)?b(s,o(e(P),e(t).overrides)):b(s,f()))}),Lt(),dt();var Fe=fa(),ze=nt(Fe);sa(ze,{});var Te=n(ze,2),De=r(Te);Zt(De,{title:"Settings",showBack:!0,onBack:c,onMenu:()=>{},sticky:!1});var Ee=n(De,2),oe=r(Ee),Ce=n(r(oe),2),Ne=r(Ce),ne=r(Ne),ce=r(ne),bt=n(r(ce),2);i(ce);var yt=n(ce,2);{var Pt=a=>{var d=va();R(a,d)},St=a=>{var d=qt(),p=nt(d);{var S=T=>{var V=da();R(T,V)},se=T=>{var V=pa();ea(V,5,()=>(e(t),_(()=>e(t).profiles)),ta,(Ft,w)=>{var Y=ua(),$e=r(Y),xe=r($e),zt=r(xe,!0);i(xe);var rt=n(xe,2),Tt=r(rt,!0);i(rt),i($e);var Be=n($e,2),Dt=r(Be,!0);i(Be),i(Y),Oe((Et,Ct)=>{re(Y,1,(e(t),e(w),_(()=>"card ".concat(e(t).selectedProfileId===e(w).emulator_id?"active":""))),"svelte-1i19ct2"),O(zt,(e(w),_(()=>e(w).name))),O(Tt,(e(w),_(()=>e(w).emulator_id))),K(Be,"title",Et),O(Dt,Ct)},[()=>(e(w),_(()=>J(e(w)))),()=>(e(w),_(()=>J(e(w))))]),$("click",Y,()=>m(e(w))),R(Ft,Y)}),i(V),R(T,V)};ct(p,T=>{e(t),_(()=>e(t).profiles.length===0)?T(S):T(se,!1)},!0)}R(a,d)};ct(yt,a=>{e(t),_(()=>e(t).loadingProfiles)?a(Pt):a(St,!1)})}i(ne);var He=n(ne,2),ve=r(He),de=r(ve),Re=r(de),kt=r(Re,!0);i(Re),W(2),i(de);var Me=n(de,2),Ue=r(Me),ue=n(Ue,2),te=n(ue,2),wt=r(te,!0);i(te),i(Me),i(ve);var pe=n(ve,2),qe=n(r(pe),2);C(qe),i(pe);var fe=n(pe,2),Ke=n(r(fe),2);C(Ke),i(fe);var me=n(fe,2),Le=n(r(me),2);C(Le),W(2),i(me);var ge=n(me,2),Ge=n(r(ge),2);C(Ge),W(2),i(ge);var Je=n(ge,2),he=r(Je),je=r(he);C(je),W(2),i(he);var _e=n(he,2);C(_e),i(Je),i(He),i(Ne),i(Ce),i(oe);var be=n(oe,2),Ve=n(r(be),2),ye=r(Ve),Ye=n(r(ye),2),j=r(Ye);C(j);var Qe=n(j,2),It=r(Qe);i(Qe),i(Ye),i(ye);var Pe=n(ye,2),We=r(Pe);C(We),W(2),i(Pe);var Xe=n(Pe,2),ae=r(Xe),$t=r(ae,!0);i(ae),i(Xe),i(Ve),i(be);var Se=n(be,2),Ze=n(r(Se),2),ke=r(Ze),et=n(r(ke),2),xt=r(et,!0);i(et),i(ke);var we=n(ke,2),tt=n(r(we),2),Bt=r(tt,!0);i(tt),i(we);var at=n(we,2),Ie=r(at),Ot=n(Ie,2);i(at),i(Ze),i(Se);var st=n(Se,2),it=n(r(st),2),At=r(it);la(At,{}),i(it),i(st),i(Ee),i(Te),Oe(a=>{var d;O(kt,e(P)?"Edit Profile":"New Profile"),ue.disabled=(e(t),e(s),_(()=>e(t).savingProfile||!e(s).emulatorId)),te.disabled=(e(t),_(()=>e(t).savingProfile)),O(wt,(e(t),_(()=>e(t).savingProfile?"Saving...":"Save"))),_e.disabled=(e(s),_(()=>!e(s).useOverride)),K(j,"min",(e(t),_(()=>e(t).retentionBounds[0]))),K(j,"max",(e(t),_(()=>e(t).retentionBounds[1]))),O(It,"".concat((d=e(z))!=null?d:""," versions")),ae.disabled=(e(t),_(()=>e(t).savingSettings)),O($t,(e(t),_(()=>e(t).savingSettings?"Saving...":"Save changes"))),O(xt,(e(t),_(()=>{var p,S;return(S=(p=e(t).storageInfo)==null?void 0:p.history_path)!=null?S:"-"}))),O(Bt,a),Ie.disabled=(e(t),_(()=>!e(t).storageInfo))},[()=>(e(t),_(()=>{var a,d;return e(t).loadingStorage?"Calculating...":le((d=(a=e(t).storageInfo)==null?void 0:a.size_bytes)!=null?d:0)}))]),$("click",bt,k),$("click",Ue,ee),$("click",ue,Z),$("click",te,G),q(qe,()=>e(s).name,a=>U(s,e(s).name=a)),q(Ke,()=>e(s).emulatorId,a=>U(s,e(s).emulatorId=a)),q(Le,()=>e(s).savePath,a=>U(s,e(s).savePath=a)),q(Ge,()=>e(s).patterns,a=>U(s,e(s).patterns=a)),vt(je,()=>e(s).useOverride,a=>U(s,e(s).useOverride=a)),q(_e,()=>e(s).overridePath,a=>U(s,e(s).overridePath=a)),q(j,()=>e(z),a=>b(z,a)),vt(We,()=>e(E),a=>b(E,a)),$("click",ae,_t),$("click",Ie,H),$("click",Ot,()=>I.clearHistory()),R(u,Fe),ft(),A()}export{$a as component};
